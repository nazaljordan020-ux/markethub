<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - MarketHub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-orange-50 via-white to-orange-50">
    <header class="sticky top-0 z-50 border-b border-orange-100 bg-white/80 backdrop-blur-md">
        <div class="container mx-auto flex h-16 items-center justify-between px-4">
            <a href="marketplace.html" class="flex items-center gap-2">
                <svg class="h-7 w-7 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
                </svg>
                <span class="text-xl font-bold text-gray-900">MarketHub</span>
            </a>
        </div>
    </header>

    <div class="container mx-auto max-w-4xl px-4 py-8">
        <div class="mb-6">
            <a href="marketplace.html">
                <button class="text-gray-600 hover:text-gray-900 flex items-center gap-2">
                    <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                    Back to Marketplace
                </button>
            </a>
        </div>

        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">My Orders</h1>
            <p class="mt-2 text-gray-600">Track and manage your purchases</p>
        </div>

        <div id="orders-container" class="space-y-4">
            <!-- Orders will be loaded here -->
        </div>

        <div id="loading" class="flex justify-center py-16">
            <div class="animate-spin h-8 w-8 border-4 border-orange-600 border-t-transparent rounded-full"></div>
        </div>

        <div id="empty-state" style="display: none;" class="bg-white border border-orange-100 rounded-xl p-16 text-center">
            <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
            </svg>
            <h3 class="text-xl font-semibold text-gray-900">No Orders Yet</h3>
            <p class="mt-2 text-gray-600">Start shopping to see your orders here</p>
            <a href="marketplace.html" class="inline-block mt-4">
                <button class="bg-orange-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-orange-700">Browse Marketplace</button>
            </a>
        </div>
    </div>

    <script>
        // Load Firebase config
        let firebaseConfig = null;
        try {
            firebaseConfig = JSON.parse(localStorage.getItem('firebaseConfig'));
        } catch (e) {
            console.error('Error loading Firebase config:', e);

              apiKey: "AIzaSyDo4y9nmVryC29QJMF66pA-pjo-tWAoeDY",
  authDomain: "shopline-7a14f.firebaseapp.com",
  projectId: "shopline-7a14f",
  storageBucket: "shopline-7a14f.firebasestorage.app",
  messagingSenderId: "1064176765834",
  appId: "1:1064176765834:web:f30944d3768599d137d673",
  measurementId: "G-49Q3CBV09C"
        }

        if (!firebaseConfig) {
            window.location.href = 'config-helper.html';
        } else {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            auth.onAuthStateChanged(async (user) => {
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
                loadOrders(user.uid);
            });

            async function loadOrders(userId) {
                try {
                    const snapshot = await db.collection('orders')
                        .where('buyerId', '==', userId)
                        .orderBy('createdAt', 'desc')
                        .get();

                    document.getElementById('loading').style.display = 'none';

                    if (snapshot.empty) {
                        document.getElementById('empty-state').style.display = 'block';
                        return;
                    }

                    const container = document.getElementById('orders-container');
                    snapshot.forEach(doc => {
                        const order = { id: doc.id, ...doc.data() };
                        const orderCard = createOrderCard(order);
                        container.appendChild(orderCard);
                    });
                } catch (error) {
                    console.error('Error loading orders:', error);
                }
            }

            function createOrderCard(order) {
                const statusColors = {
                    'pending_payment': 'bg-gray-100 text-gray-800',
                    'paid': 'bg-green-100 text-green-800',
                    'processing': 'bg-blue-100 text-blue-800',
                    'shipped': 'bg-purple-100 text-purple-800',
                    'delivered': 'bg-green-100 text-green-800',
                    'cancelled': 'bg-red-100 text-red-800'
                };

                const card = document.createElement('div');
                card.className = 'bg-white border border-orange-100 rounded-xl p-6';
                card.innerHTML = `
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="font-semibold text-lg text-gray-900">Order #${order.id.slice(0, 8)}</h3>
                            <p class="text-sm text-gray-600">${new Date(order.createdAt).toLocaleDateString()}</p>
                        </div>
                        <span class="${statusColors[order.status] || 'bg-gray-100 text-gray-800'} px-3 py-1 rounded-full text-xs font-semibold">
                            ${order.status.replace('_', ' ').toUpperCase()}
                        </span>
                    </div>
                    <div class="flex gap-4">
                        <div class="h-20 w-20 flex-shrink-0 rounded-lg bg-gray-100 overflow-hidden">
                            ${order.productImage ? 
                                `<img src="${order.productImage}" alt="${order.productName}" class="h-full w-full object-cover">` :
                                '<div class="h-full w-full flex items-center justify-center"><svg class="h-8 w-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg></div>'
                            }
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${order.productName}</h4>
                            <p class="text-sm text-gray-600 mt-1">Seller: ${order.sellerName}</p>
                            <p class="text-lg font-bold text-orange-600 mt-1">â‚±${order.productPrice.toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="mt-4 p-3 bg-orange-50 border border-orange-100 rounded-lg">
                        <p class="text-sm font-medium text-gray-900">${order.shippingAddress.fullName}</p>
                        <p class="text-sm text-gray-600">${order.shippingAddress.phone}</p>
                        <p class="text-sm text-gray-600">${order.shippingAddress.address}, ${order.shippingAddress.city}, ${order.shippingAddress.province}</p>
                    </div>
                    <div class="mt-4 flex items-center justify-between text-sm">
                        <span class="text-gray-600">Payment Method:</span>
                        <span class="font-medium capitalize">${order.paymentMethod.replace('_', ' ')}</span>
                    </div>
                `;
                return card;
            }
        }
    </script>
</body>
</html>
